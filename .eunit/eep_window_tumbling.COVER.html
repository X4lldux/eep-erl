<html>
<head><title>.eunit/eep_window_tumbling.COVER.html</title></head><body bgcolor=white text=black>
<pre>
File generated from /Users/morton_swimmer/Projects/eep-erl/.eunit/eep_window_tumbling.erl by COVER 2013-02-23 at 18:38:22

****************************************************************************

        |  %% -------------------------------------------------------------------
        |  %% Copyright (c) 2013 Darach Ennis &lt; darach at gmail dot com &gt; 
        |  %%
        |  %% Permission is hereby granted, free of charge, to any person obtaining a
        |  %% copy of this software and associated documentation files (the
        |  %% "Software"), to deal in the Software without restriction, including
        |  %% without limitation the rights to use, copy, modify, merge, publish,
        |  %% distribute, sublicense, and/or sell copies of the Software, and to permit
        |  %% persons to whom the Software is furnished to do so, subject to the
        |  %% following conditions:
        |  %%
        |  %% The above copyright notice and this permission notice shall be included
        |  %% in all copies or substantial portions of the Software.
        |  %%
        |  %% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
        |  %% OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
        |  %% MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
        |  %% NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
        |  %% DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
        |  %% OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
        |  %% USE OR OTHER DEALINGS IN THE SOFTWARE.
        |  %%
        |  %% File: eep_window_tumbling.erl. Tumbling aggregate window.
        |  %%
        |  %% -------------------------------------------------------------------
        |  
        |  -module(eep_window_tumbling).
        |  
        |  -include_lib("eep_erl.hrl").
        |  
        |  -export([start/2]).
        |  
        |  %% @private.
        |  -export([tumble/3]).
        |  
        |  start(Mod, Size) -&gt;
     1..|    {ok, EventPid } = gen_event:start_link(),
     1..|    spawn(?MODULE, tumble, [Mod, Size, EventPid]).
        |  
        |  tumble(Mod, Size, EventPid) -&gt;
     1..|    tumble(Mod, Size, EventPid, 1, apply(Mod, init, [])).
        |  
        |  tumble(Mod, Size, EventPid, Count, State) -&gt;
    14..|    receive
        |      { push, Event } -&gt;
     9..|        case Count &gt;= Size of
        |          false -&gt; 
     5..|            tumble(Mod, Size, EventPid, Count+1, apply(Mod, accumulate, [State, Event]));
        |          true -&gt;
     4..|  		   NewState = apply(Mod, accumulate, [State, Event]),
     4..|             gen_event:notify(EventPid, {emit, apply(Mod, emit, [NewState])}),
     4..|             tumble(Mod, Size, EventPid, 1, apply(Mod, init, []))
        |        end;
        |      { add_handler, Handler, Arr } -&gt;
<font color=red>     0..|        gen_event:add_handler(EventPid, Handler, Arr),</font>
<font color=red>     0..|        tumble(Mod, Size, EventPid, Count, State);</font>
        |      { delete_handler, Handler } -&gt;
<font color=red>     0..|        gen_event:delete_handler(EventPid, Handler),</font>
<font color=red>     0..|        tumble(Mod, Size, EventPid, Count, State);</font>
        |      stop -&gt;
     1..|        ok;
        |      {debug, From} -&gt;
     4..|        From ! {debug, {Mod, Size, Count, State}},
     4..|        tumble(Mod, Size, EventPid, Count, State)
        |    end.
        |  
        |  -ifdef(TEST).
        |  
        |  basic_test() -&gt;
     1..|    Pid = start(eep_stats_count, 2),
     1..|    Pid ! {push, foo},
     1..|    Pid ! {push, bar},
     1..|    Pid ! {debug, self()},
     1..|    receive
     1..|      { debug, Debug0 } -&gt; {eep_stats_count, _, _, 0} = Debug0
        |    end,
     1..|    Pid ! {push, baz},
     1..|    Pid ! {debug, self()},
     1..|    receive
     1..|       { debug, Debug1 } -&gt; {eep_stats_count, _, _, 1} = Debug1
        |    end,
     1..|    Pid ! {push, foo},
     1..|    Pid ! {push, bar},
     1..|    Pid ! {push, foo},
     1..|    Pid ! {push, bar},
     1..|    Pid ! {push, foo},
     1..|    Pid ! {push, bar},
     1..|    Pid ! {debug, self()},
     1..|    receive
     1..|      { debug, Debug2 } -&gt; {eep_stats_count, _, _, 1} = Debug2
        |    end,
     1..|    Pid ! {debug, self()},
     1..|    receive
     1..|       { debug, Debug3 } -&gt; {eep_stats_count, _, _, 1} = Debug3
        |    end,
     1..|    Pid ! stop.
        |  
        |  -endif.
</pre>
</body>
</html>
